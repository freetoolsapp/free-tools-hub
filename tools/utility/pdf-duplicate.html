<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5GGQGP06F0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-5GGQGP06F0');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary SEO Meta Tags -->
    <title>Duplicate PDF Pages Online Free — Copy PDF Pages Tool 2026 | Free Tools Hub</title>
    <meta name="title" content="Duplicate PDF Pages Online Free — Copy & Repeat PDF Pages Instantly">
    <meta name="description" content="Free online PDF page duplicator 2026. Copy and repeat specific pages in your PDF documents instantly. No signup, no watermarks. Preview pages before duplicating. 100% secure & browser-based.">
    <meta name="keywords" content="duplicate PDF pages, copy PDF pages, repeat PDF pages, PDF page duplicator, duplicate pages in PDF online, copy PDF pages free, PDF page copier, replicate PDF pages 2026">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="author" content="Free Tools Hub">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://freetoolshub.online/tools/pdf/duplicate-pdf-pages.html">
    <meta property="og:site_name" content="Free Tools Hub">
    <meta property="og:title" content="Duplicate PDF Pages Online Free — Free Tools Hub">
    <meta property="og:description" content="Copy and repeat specific pages in your PDF instantly. Free, secure, no signup required. Preview pages before duplicating.">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://freetoolshub.online/tools/utility/pdf-duplicate.html">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../style.css">
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Duplicate PDF Pages",
        "url": "https://freetoolshub.online/tools/pdf/duplicate-pdf-pages.html",
        "description": "Free online tool to duplicate and copy specific pages in PDF documents with preview functionality.",
        "applicationCategory": "UtilityApplication",
        "operatingSystem": "Any",
        "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
        "creator": {"@type": "Organization", "name": "Free Tools Hub", "url": "https://freetoolshub.online"}
    }
    </script>
    
    <style>
        .tool-hero{background:linear-gradient(135deg,#7c3aed,#6d28d9);color:white;padding:64px 0 48px;position:relative;overflow:hidden;}
        .tool-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 70% at 70% 30%,rgba(236,72,153,.18) 0%,transparent 60%);}
        .tool-hero-inner{position:relative;z-index:1;text-align:center;}
        .tool-icon-lg{width:80px;height:80px;background:rgba(255,255,255,.12);backdrop-filter:blur(8px);border-radius:20px;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;font-size:36px;}
        
        .upload-card{background:white;border:1.5px solid #e5e7eb;border-radius:16px;padding:40px;margin-bottom:32px;}
        .upload-zone{border:2px dashed #d1d5db;border-radius:12px;padding:48px 24px;text-align:center;cursor:pointer;transition:all .2s;position:relative;}
        .upload-zone:hover,.upload-zone.drag-over{border-color:#7c3aed;background:rgba(124,58,237,.05);}
        .upload-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;font-size:16px;}
        .upload-icon{width:72px;height:72px;border-radius:12px;background:rgba(124,58,237,.1);color:#7c3aed;display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 18px;}
        
        .preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;margin-top:32px;}
        .page-thumb{position:relative;border:2px solid #e5e7eb;border-radius:12px;overflow:hidden;cursor:pointer;transition:all .2s;aspect-ratio:210/297;background:white;}
        .page-thumb:hover{border-color:#7c3aed;transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,0,0,.1);}
        .page-thumb.selected{border-color:#7c3aed;box-shadow:0 0 0 3px rgba(124,58,237,.2);}
        .page-canvas-img{width:100%;height:100%;object-fit:contain;display:block;}
        .page-num{position:absolute;top:8px;left:8px;background:rgba(0,0,0,.7);color:white;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:700;}
        .page-plus{position:absolute;top:8px;right:8px;width:32px;height:32px;background:#7c3aed;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;opacity:0;transition:all .2s;}
        .page-thumb:hover .page-plus{opacity:1;}
        .page-thumb.selected .page-plus{opacity:1;background:#059669;}
        
        .controls-bar{background:#f5f3ff;border:1.5px solid rgba(124,58,237,.2);border-radius:12px;padding:24px;margin-top:32px;}
        .controls-grid{display:grid;grid-template-columns:2fr 1fr 1fr;gap:16px;align-items:end;}
        
        .result-preview{background:white;border:1.5px solid #e5e7eb;border-radius:16px;padding:32px;margin-top:32px;text-align:center;}
        .success-icon{width:72px;height:72px;border-radius:50%;background:#d1fae5;color:#059669;display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 20px;}
        
        .info-banner{background:#f5f3ff;border-left:4px solid #7c3aed;padding:16px 20px;border-radius:8px;margin-bottom:24px;}
        .info-banner-title{font-weight:700;color:#4c1d95;margin-bottom:4px;font-size:14px;}
        .info-banner-text{font-size:13px;color:#6d28d9;}
        
        @keyframes spin{to{transform:rotate(360deg);}}
        @media(max-width:768px){
            .controls-grid{grid-template-columns:1fr;}
            .preview-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));}
        }
    </style>
    <link rel="stylesheet" href="../../header-new.css">
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#5b21b6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Free Tools Hub">
    <link rel="apple-touch-icon" href="/icon-192.png">
</head>
<body>

    <div id="site-header"></div>
    <script src="../../header.js"></script>

    <div class="breadcrumb" style="background:white;border-bottom:1px solid #e5e7eb;padding:12px 0;">
        <div class="container">
            <div style="display:flex;align-items:center;gap:8px;font-size:13px;color:#6b7280;">
                <a href="../../index.html" style="color:#6b7280;"><i class="fas fa-home"></i> Home</a>
                <span style="color:#d1d5db;"><i class="fas fa-chevron-right"></i></span>
                <a href="../../tools.html" style="color:#6b7280;">Tools</a>
                <span style="color:#d1d5db;"><i class="fas fa-chevron-right"></i></span>
                <span style="color:#111827;font-weight:500;">Duplicate PDF Pages</span>
            </div>
        </div>
    </div>

    <section class="tool-hero">
        <div class="container tool-hero-inner">
            <div class="tool-icon-lg"><i class="fas fa-copy"></i></div>
            <h1 style="font-size:clamp(2.2rem,4vw,3.2rem);font-weight:800;letter-spacing:-.03em;margin-bottom:12px;">Duplicate PDF Pages</h1>
            <p style="font-size:1.05rem;opacity:.85;font-weight:300;max-width:560px;margin:0 auto 16px;">Copy and repeat specific pages in your PDF with preview — 100% free & secure</p>
            <div style="display:flex;justify-content:center;gap:16px;flex-wrap:wrap;font-size:13px;opacity:.80;">
                <span><i class="fas fa-check-circle"></i> Preview Pages</span>
                <span><i class="fas fa-check-circle"></i> Visual Selection</span>
                <span><i class="fas fa-check-circle"></i> No Upload</span>
                <span><i class="fas fa-check-circle"></i> 100% Secure</span>
            </div>
        </div>
    </section>

    <main style="background:#f9fafb;padding:56px 0;">
        <div class="container" style="max-width:1100px;">

            <!-- Upload Card -->
            <div class="upload-card" id="uploadCard">
                <h2 style="font-size:1.6rem;font-weight:800;color:#111827;margin-bottom:28px;text-align:center;display:flex;align-items:center;justify-content:center;gap:12px;">
                    <i class="fas fa-file-pdf" style="color:#7c3aed;"></i> Upload Your PDF File
                </h2>
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept=".pdf,application/pdf">
                    <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                    <p style="font-size:18px;font-weight:700;color:#1f2937;margin-bottom:8px;">Drop your PDF here</p>
                    <p style="font-size:14px;color:#6b7280;">or click to browse • PDF files only • Max 50MB</p>
                </div>
                <p id="uploadError" style="display:none;color:#dc2626;text-align:center;margin-top:12px;font-size:14px;font-weight:600;"></p>
            </div>

            <!-- Preview & Controls Card -->
            <div style="display:none;" id="previewCard">
                
                <div class="info-banner">
                    <div class="info-banner-title"><i class="fas fa-info-circle"></i> How to Duplicate Pages</div>
                    <div class="info-banner-text">Click the <strong>+ button</strong> on any page thumbnail to select it for duplication. Selected pages show a ✓ checkmark. Set copies below and click Duplicate.</div>
                </div>

                <div style="background:white;border:1.5px solid #e5e7eb;border-radius:16px;padding:32px;">
                    <h3 style="font-size:1.4rem;font-weight:800;color:#111827;margin-bottom:8px;">
                        <i class="fas fa-images" style="color:#7c3aed;"></i> Preview & Select Pages
                    </h3>
                    <p style="font-size:14px;color:#6b7280;margin-bottom:24px;">Document: <strong id="docName">—</strong> • Pages: <strong id="pageCount">0</strong></p>
                    
                    <div class="preview-grid" id="previewGrid"></div>

                    <div class="controls-bar">
                        <div style="margin-bottom:16px;font-size:13px;color:#6d28d9;font-weight:600;">
                            <i class="fas fa-check-circle"></i> Selected: <span id="selectedCount">0</span> page(s)
                        </div>
                        <div class="controls-grid">
                            <div>
                                <label style="display:block;font-size:12px;font-weight:700;color:#374151;margin-bottom:6px;text-transform:uppercase;letter-spacing:.06em;">Selected Pages</label>
                                <input type="text" id="selectedPages" readonly style="width:100%;padding:12px 16px;border:1.5px solid #d1d5db;border-radius:8px;font-size:14px;background:white;color:#6b7280;" placeholder="Click + on pages above">
                            </div>
                            <div>
                                <label for="numCopies" style="display:block;font-size:12px;font-weight:700;color:#374151;margin-bottom:6px;text-transform:uppercase;letter-spacing:.06em;">Copies per Page</label>
                                <input type="number" id="numCopies" value="1" min="1" max="10" style="width:100%;padding:12px 16px;border:1.5px solid #d1d5db;border-radius:8px;font-size:14px;">
                            </div>
                            <div>
                                <button id="duplicateBtn" onclick="duplicatePages()" style="width:100%;padding:12px 20px;background:linear-gradient(135deg,#7c3aed,#c026d3);color:white;border:none;border-radius:8px;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;">
                                    <i class="fas fa-copy"></i> Duplicate
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Processing -->
            <div style="display:none;text-align:center;padding:60px 20px;" id="processing">
                <div style="width:64px;height:64px;border:4px solid #e5e7eb;border-top-color:#7c3aed;border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 24px;"></div>
                <h3 style="font-size:1.3rem;font-weight:700;color:#111827;margin-bottom:8px;">Processing your PDF...</h3>
                <p style="font-size:14px;color:#6b7280;">Please wait while we duplicate the selected pages</p>
            </div>

            <!-- Download Card -->
            <div class="result-preview" style="display:none;" id="downloadCard">
                <div class="success-icon"><i class="fas fa-check"></i></div>
                <h3 style="font-size:1.8rem;font-weight:800;color:#111827;margin-bottom:12px;">Pages Duplicated Successfully!</h3>
                <p style="font-size:15px;color:#4b5563;margin-bottom:28px;">Your PDF has been updated with the duplicated pages and is ready to download.</p>
                
                <button onclick="downloadPDF()" style="display:inline-flex;align-items:center;gap:10px;padding:16px 40px;background:linear-gradient(135deg,#059669,#0d9488);color:white;border:none;border-radius:999px;font-size:17px;font-weight:700;cursor:pointer;box-shadow:0 4px 16px rgba(5,150,105,.3);transition:all .2s;">
                    <i class="fas fa-download"></i> Download PDF
                </button>
                
                <div style="margin-top:20px;">
                    <button onclick="resetTool()" style="display:inline-flex;align-items:center;gap:8px;padding:12px 28px;background:#f3f4f6;color:#374151;border:none;border-radius:999px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;">
                        <i class="fas fa-redo"></i> Process Another PDF
                    </button>
                </div>
            </div>

        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <div class="site-logo"><div class="logo-icon"><i class="fas fa-bolt"></i></div><div class="logo-text"><span class="logo-name">Free Tools Hub</span></div></div>
                    <p>Your complete hub for 100+ free tools, expert blogs, tech news, educational materials & curated resources.</p>
                    <div class="footer-social" style="margin-top:20px;">
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="https://github.com/freetoolsapp" class="social-icon" target="_blank" rel="noopener"><i class="fab fa-github"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-col"><h4>Quick Links</h4><ul>
                    <li><a href="../../index.html"><i class="fas fa-home"></i>Home</a></li>
                    <li><a href="../../tools.html"><i class="fas fa-tools"></i>All Tools</a></li>
                    <li><a href="../../blog.html"><i class="fas fa-pen-nib"></i>Blog</a></li>
                    <li><a href="../../education.html"><i class="fas fa-graduation-cap"></i>Education</a></li>
                    <li><a href="../../contact.html"><i class="fas fa-envelope"></i>Contact</a></li>
                </ul></div>
                <div class="footer-col"><h4>PDF Tools</h4><ul>
                    <li><a href="merge-pdf.html"><i class="fas fa-object-group"></i>Merge PDF</a></li>
                    <li><a href="split-pdf.html"><i class="fas fa-cut"></i>Split PDF</a></li>
                    <li><a href="compress-pdf.html"><i class="fas fa-compress-alt"></i>Compress PDF</a></li>
                    <li><a href="rotate-pdf.html"><i class="fas fa-sync-alt"></i>Rotate PDF</a></li>
                </ul></div>
                <div class="footer-col"><h4>Legal</h4><ul>
                    <li><a href="../../privacy.html"><i class="fas fa-shield-alt"></i>Privacy Policy</a></li>
                    <li><a href="../../terms.html"><i class="fas fa-file-contract"></i>Terms of Service</a></li>
                    <li><a href="../../disclaimer.html"><i class="fas fa-exclamation-circle"></i>Disclaimer</a></li>
                </ul></div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 <a href="../../index.html">Free Tools Hub</a>. All rights reserved. Made with <span class="heart">♥</span> for creators.</p>
                <div class="footer-legal"><a href="../../privacy.html">Privacy</a><a href="../../terms.html">Terms</a><a href="../../disclaimer.html">Disclaimer</a></div>
            </div>
        </div>
    </footer>

    <!-- PDF.js and PDF-lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

    <script>
        // ── PDF.js worker ──
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // ── Safe mobile menu init (header.js loads async) ──
        function initMobileMenu() {
            var btn  = document.getElementById('mobileMenuBtn');
            var menu = document.getElementById('mobileMenu');
            if (!btn || !menu || btn._ready) return;
            btn._ready = true;
            btn.addEventListener('click', function() {
                var open = menu.classList.toggle('open');
                btn.setAttribute('aria-expanded', open);
                btn.innerHTML = open ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
            });
            menu.querySelectorAll('a').forEach(function(l) {
                l.addEventListener('click', function() {
                    menu.classList.remove('open');
                    btn.setAttribute('aria-expanded', 'false');
                    btn.innerHTML = '<i class="fas fa-bars"></i>';
                });
            });
        }
        initMobileMenu();
        setTimeout(initMobileMenu, 300);
        setTimeout(initMobileMenu, 1000);
        setTimeout(initMobileMenu, 2500);

        // ── State ──
        var pdfDoc       = null;
        var pdfBytes     = null;
        var resultBytes  = null;
        var selectedPages = new Set();

        var uploadZone = document.getElementById('uploadZone');
        var fileInput  = document.getElementById('fileInput');

        // ── Drag & Drop ──
        uploadZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });
        uploadZone.addEventListener('dragleave', function() {
            uploadZone.classList.remove('drag-over');
        });
        uploadZone.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            var f = e.dataTransfer.files[0];
            if (f) handleFile(f);
        });

        // ── File input change (main mobile trigger) ──
        fileInput.addEventListener('change', function(e) {
            var f = e.target.files && e.target.files[0];
            if (f) {
                handleFile(f);
                try { fileInput.value = ''; } catch(ex) {}
            }
        });

        function showError(msg) {
            var el = document.getElementById('uploadError');
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(function() { el.style.display = 'none'; }, 4000);
        }

        async function handleFile(file) {
            // Validate: must be PDF by type OR extension
            var isPDF = file.type === 'application/pdf' ||
                        (file.name && file.name.toLowerCase().endsWith('.pdf'));
            if (!isPDF) {
                showError('⚠️ Please upload a PDF file only.');
                return;
            }
            if (file.size > 50 * 1024 * 1024) {
                showError('⚠️ File too large. Maximum size is 50MB.');
                return;
            }

            try {
                document.getElementById('docName').textContent = file.name;
                pdfBytes = await file.arrayBuffer();

                // Load with PDF-lib for manipulation
                pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
                var pageCount = pdfDoc.getPageCount();
                document.getElementById('pageCount').textContent = pageCount;

                // Reset selection
                selectedPages.clear();
                updateSelected();

                // Render thumbnails
                await renderPreviews(pdfBytes, pageCount);

                document.getElementById('uploadCard').style.display = 'none';
                document.getElementById('downloadCard').style.display = 'none';
                document.getElementById('previewCard').style.display = 'block';

            } catch(err) {
                showError('❌ Error loading PDF: ' + err.message);
                console.error(err);
            }
        }

        async function renderPreviews(arrayBuffer, pageCount) {
            var grid = document.getElementById('previewGrid');
            grid.innerHTML = '<p style="color:#6b7280;font-size:14px;">Loading previews...</p>';

            // Use a copy of the buffer for PDF.js (ArrayBuffer can only be used once)
            var bufCopy = arrayBuffer.slice(0);
            var pdf = await pdfjsLib.getDocument({data: bufCopy}).promise;

            grid.innerHTML = '';

            for (var i = 1; i <= pageCount; i++) {
                var page    = await pdf.getPage(i);
                var vp      = page.getViewport({scale: 0.5});
                var canvas  = document.createElement('canvas');
                canvas.width  = vp.width;
                canvas.height = vp.height;
                await page.render({canvasContext: canvas.getContext('2d'), viewport: vp}).promise;

                var dataURL = canvas.toDataURL('image/jpeg', 0.7); // JPEG for smaller memory

                var thumb = document.createElement('div');
                thumb.className = 'page-thumb';
                thumb.dataset.page = i;
                thumb.innerHTML =
                    '<div class="page-num">Page ' + i + '</div>' +
                    '<div class="page-plus"><i class="fas fa-plus"></i></div>' +
                    '<img src="' + dataURL + '" class="page-canvas-img" alt="Page ' + i + '">';

                (function(pageNum, el) {
                    el.addEventListener('click', function() { togglePage(pageNum, el); });
                })(i, thumb);

                grid.appendChild(thumb);
            }
        }

        function togglePage(pageNum, element) {
            if (selectedPages.has(pageNum)) {
                selectedPages.delete(pageNum);
                element.classList.remove('selected');
                element.querySelector('.page-plus i').className = 'fas fa-plus';
            } else {
                selectedPages.add(pageNum);
                element.classList.add('selected');
                element.querySelector('.page-plus i').className = 'fas fa-check';
            }
            updateSelected();
        }

        function updateSelected() {
            var count  = selectedPages.size;
            var sorted = Array.from(selectedPages).sort(function(a,b){return a-b;});
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('selectedPages').value = sorted.length ? sorted.join(', ') : '';
            document.getElementById('duplicateBtn').disabled = (count === 0);
        }

        async function duplicatePages() {
            if (selectedPages.size === 0) {
                alert('⚠️ Please select at least one page to duplicate.');
                return;
            }

            var numCopies = parseInt(document.getElementById('numCopies').value, 10);
            if (!numCopies || numCopies < 1 || numCopies > 10) {
                alert('⚠️ Number of copies must be between 1 and 10.');
                return;
            }

            document.getElementById('previewCard').style.display  = 'none';
            document.getElementById('processing').style.display   = 'block';

            try {
                var newPdf     = await PDFLib.PDFDocument.create();
                var totalPages = pdfDoc.getPageCount();

                for (var i = 0; i < totalPages; i++) {
                    // Add original page
                    var orig = await newPdf.copyPages(pdfDoc, [i]);
                    newPdf.addPage(orig[0]);

                    // Add duplicate copies right after
                    if (selectedPages.has(i + 1)) {
                        for (var j = 0; j < numCopies; j++) {
                            var dup = await newPdf.copyPages(pdfDoc, [i]);
                            newPdf.addPage(dup[0]);
                        }
                    }
                }

                resultBytes = await newPdf.save();

                document.getElementById('processing').style.display  = 'none';
                document.getElementById('downloadCard').style.display = 'block';
                document.getElementById('downloadCard').scrollIntoView({behavior:'smooth'});

            } catch(err) {
                alert('❌ Error processing PDF: ' + err.message);
                console.error(err);
                document.getElementById('processing').style.display  = 'none';
                document.getElementById('previewCard').style.display = 'block';
            }
        }

        function downloadPDF() {
            if (!resultBytes) { alert('❌ No processed file found. Please try again.'); return; }
            var blob = new Blob([resultBytes], {type: 'application/pdf'});
            var url  = URL.createObjectURL(blob);
            var a    = document.createElement('a');
            a.href   = url;
            a.download = 'duplicated-pages.pdf';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function resetTool() {
            pdfDoc        = null;
            pdfBytes      = null;
            resultBytes   = null;
            selectedPages.clear();
            try { fileInput.value = ''; } catch(ex) {}
            document.getElementById('previewGrid').innerHTML = '';
            document.getElementById('numCopies').value = '1';
            document.getElementById('uploadCard').style.display  = 'block';
            document.getElementById('previewCard').style.display = 'none';
            document.getElementById('processing').style.display  = 'none';
            document.getElementById('downloadCard').style.display = 'none';
            window.scrollTo({top:0, behavior:'smooth'});
        }
    </script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function() { console.log('SW registered'); })
                    .catch(function(err) { console.log('SW error:', err); });
            });
        }
    </script>
</body>
</html>
